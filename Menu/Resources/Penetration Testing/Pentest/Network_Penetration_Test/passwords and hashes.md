- Windows uses MD4 algorithm to store NTLM passwords.

- c:\>psexec.exe -s -i -d cmd.exe : open the command prompt as local system.

- if we have SAM database and SYSTEM hives then we do not need to run the cmd.exe as local system. Administrator user can see NTLM hashes with hash dump utility.

- In active directory we have to use ntds.dit and system file. 

- Extract ntds.dit file data. Generally gives the tuples information from the ntds.dit file.
  <pre>
  c:\>esedbexport.exe ntds.dit
  
      esedbexport 20120102
    Opening file.

    Exporting table 1 (MSysObjects) out of 11.
    Exporting table 2 (MSysObjectsShadow) out of 11.
    Exporting table 3 (MSysUnicodeFixupVer1) out of 11.
    Exporting table 4 (datatable) out of 11.
    Exporting table 5 (link_table) out of 11.
    Exporting table 6 (hiddentable) out of 11.
    Exporting table 7 (sdproptable) out of 11.
    Exporting table 8 (sd_table) out of 11.
    Exporting table 9 (quota_table) out of 11.
    Exporting table 10 (quota_rebuild_progress_table) out of 11.
    Exporting table 11 (MSysDefrag1) out of 11.
    Export completed.
  </pre>

- Use dsusers.py to extract tuples values:
  <pre>
   C:\>dsusers.py 
   DSUsers v1.2
   Extracts information related to user objects
   usage: c:\>dsusers.py (datatable) (linktable) (work directory) [option]
   datatable
   The path to the file called datatable extracted by esedbexport
     linktable
   The path to the file called linktable extracted by esedbexport
   work directory
   The path to the directory where ntdsxtract should store its
   cache files and output files. If the directory does not exist
   it will be created.

   options:
   --rid <user rid>
   List user identified by RID
   --name <user name>
   List user identified by Name
       --syshive <path to system hive>
   Required for password hash and history extraction
   This option should be specified before the password hash
   and password history extraction options!
   --lmoutfile    <name of the LM hash output file>
   --ntoutfile      <name of the NT hash output file>
   --pwdformat  <format of the hash output>
   ophc - OphCrack format
   When this format is specified the NT output file will be used
   john - John The Ripper format
   --passwordhashes
   Extract password hashes
       --passwordhistory
   Extract password history
   --certificates
   Extract certificates
   --supplcreds
   Extract kerberos keys
   --membership
   List groups of which the user is a member
   --csvoutfile (name of the CSV output file)
  The filename of the csv file to which ntdsxtract should write the output
  </pre>

- Sample password hashes:
  <pre>
  e19ccf75ee54e06b06a5907af13cef42 P@ssw0rd
  186cb09181e2c2ecaac768c47c729904 a
  e0fba38268d0ec66ef1cb452d5885e53 abc
  0bd63185f3484bb000286c85917dc12e abcdefghijklmnopqrstuvwxyz
  a4f49c406510bdcab6824ee7c30fd852 Password
  4ccdb7041204d5488c04637bf6adff08 Welcome
  2d20d252a479f485cdf5e171d93985bf qwerty
  f67f5e3f66efd7298be6acd32eeeb27c 1qaz2wsx
  32ed87bdb5fdc5e9cba88547376818d4 123456
  9f8419c868078392e0cbf16976724291 Dupa.8
  </pre>
