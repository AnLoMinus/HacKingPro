#!/usr/bin/env python3

import sys
import os
import json
import datetime
import importlib
import warnings
import asyncio
import subprocess
import re
import ipaddress
import ctypes
from PyQt5.QtWidgets import (QApplication, QMainWindow, QPushButton, QVBoxLayout, QWidget, QLabel, QTextEdit, 
                             QStatusBar, QHBoxLayout, QProgressBar, QMessageBox, QDialog, QScrollArea, QFileDialog, 
                             QInputDialog, QTabWidget, QFormLayout, QLineEdit, QGroupBox, QListWidget, QSplitter,
                             QDockWidget, QCheckBox, QListWidgetItem, QMenuBar, QAction, QComboBox, QDialogButtonBox,
                             QRadioButton)  # ×”×•×¡×¤× ×• QRadioButton
from PyQt5.QtGui import QFont, QPixmap, QPalette, QColor, QPainter, QIcon
from PyQt5.QtCore import Qt, QTimer, QDateTime, QRunnable, QThreadPool, pyqtSlot, QObject, pyqtSignal, QThread, QProcess
from plugins.system_monitor_plugin import SystemMonitorWidget
from text_system_monitor import TextSystemMonitorWidget
from network_monitor import NetworkMonitorWidget
from intro_manager import get_intro_widget
from help_content import HELP_CONTENT

# Ignore DeprecationWarnings
warnings.filterwarnings("ignore", category=DeprecationWarning)

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

def run_as_admin():
    ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, " ".join(sys.argv), None, 1)

def request_admin_privileges():
    if sys.platform == 'win32':
        if not is_admin():
            reply = QMessageBox.question(None, '×‘×§×©×ª ×”×¨×©××•×ª ×× ×”×œ',
                                         "×”××¤×œ×™×§×¦×™×” ×–×§×•×§×” ×œ×”×¨×©××•×ª ×× ×”×œ ×œ×¤×¢×•×œ×•×ª ××¡×•×™××•×ª. ×”×× ×‘×¨×¦×•× ×š ×œ×”×¤×¢×™×œ ××—×“×© ×¢× ×”×¨×©××•×ª ×× ×”×œ?",
                                         QMessageBox.Yes | QMessageBox.No, QMessageBox.No)
            if reply == QMessageBox.Yes:
                run_as_admin()
                sys.exit()
    elif sys.platform == 'linux':
        if os.geteuid() != 0:
            reply = QMessageBox.question(None, '×‘×§×©×ª ×”×¨×©××•×ª ×× ×”×œ',
                                         "×”××¤×œ×™×§×¦×™×” ×–×§×•×§×” ×œ×”×¨×©××•×ª ×× ×”×œ ×œ×¤×¢×•×œ×•×ª ××¡×•×™××•×ª. ×”×× ×‘×¨×¦×•× ×š ×œ×”×¤×¢×™×œ ××—×“×© ×¢× ×”×¨×©××•×ª ×× ×”×œ?",
                                         QMessageBox.Yes | QMessageBox.No, QMessageBox.No)
            if reply == QMessageBox.Yes:
                subprocess.call(['sudo', 'python3'] + sys.argv)
                sys.exit()

class CustomWidget(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setAttribute(Qt.WA_TranslucentBackground)

    def paintEvent(self, event):
        painter = QPainter(self)
        painter.setRenderHint(QPainter.Antialiasing)
        
        # Create a semi-transparent, frosted glass effect
        painter.setBrush(QColor(30, 30, 30, 128))  # 50% opacity
        painter.setPen(Qt.NoPen)
        painter.drawRoundedRect(self.rect(), 10, 10)

class HelpDialog(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("××“×¨×™×š ×œ××©×ª××© - HacKingPro")
        self.setGeometry(200, 200, 600, 400)
        self.initUI()

    def initUI(self):
        layout = QVBoxLayout()
        scroll = QScrollArea()
        content = QWidget()
        content_layout = QVBoxLayout(content)

        help_label = QLabel(HELP_CONTENT)
        help_label.setWordWrap(True)
        help_label.setStyleSheet("text-align: right; direction: rtl;")
        
        content_layout.addWidget(help_label)
        content.setLayout(content_layout)
        scroll.setWidget(content)
        scroll.setWidgetResizable(True)
        layout.addWidget(scroll)

        self.setLayout(layout)

class JournalDialog(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("×™×•××Ÿ ××©×™××•×ª")
        self.setGeometry(200, 200, 600, 500)
        self.journal_file = "journal.json"
        self.journal_data = self.load_journal()
        self.init_ui()

    def load_journal(self):
        if os.path.exists(self.journal_file):
            with open(self.journal_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {"tasks": []}

    def init_ui(self):
        layout = QVBoxLayout()
        
        self.tasks_list = QListWidget()
        self.tasks_list.setStyleSheet("background-color: rgba(30, 30, 30, 200); color: white;")
        self.tasks_list.itemDoubleClicked.connect(self.edit_task)
        layout.addWidget(self.tasks_list)

        buttons_layout = QHBoxLayout()

        add_button = QPushButton("×”×•×¡×£ ××©×™××”")
        add_button.clicked.connect(self.add_task_dialog)
        buttons_layout.addWidget(add_button)

        edit_button = QPushButton("×¢×¨×•×š ××©×™××”")
        edit_button.clicked.connect(self.edit_selected_task)
        buttons_layout.addWidget(edit_button)

        delete_button = QPushButton("××—×§ ××©×™××”")
        delete_button.clicked.connect(self.delete_selected_task)
        buttons_layout.addWidget(delete_button)

        layout.addLayout(buttons_layout)

        save_button = QPushButton("×©××•×¨ ×©×™× ×•×™×™×")
        save_button.clicked.connect(self.save_journal)
        save_button.setStyleSheet("background-color: rgba(60, 60, 60, 200); color: white;")
        layout.addWidget(save_button)

        self.setLayout(layout)

        for task in self.journal_data.get('tasks', []):
            self.add_task_to_list(task['text'], task['completed'])

    def save_journal(self):
        tasks = []
        for i in range(self.tasks_list.count()):
            item = self.tasks_list.item(i)
            task = {
                'text': item.text(),
                'completed': item.checkState() == Qt.Checked
            }
            tasks.append(task)
        
        journal_data = {
            'tasks': tasks,
            'last_updated': datetime.datetime.now().isoformat()
        }
        with open(self.journal_file, 'w', encoding='utf-8') as f:
            json.dump(journal_data, f, ensure_ascii=False, indent=2)
        QMessageBox.information(self, "×©××™×¨×”", "×”×™×•××Ÿ × ×©××¨ ×‘×”×¦×œ×—×”!")

    def add_task_dialog(self):
        task_text, ok = QInputDialog.getText(self, "×”×•×¡×¤×ª ××©××”", "×”×–×Ÿ ××©×™××” ×—×“×©×”:")
        if ok and task_text:
            self.add_task_to_list(task_text, False)

    def add_task_to_list(self, task_text, completed):
        item = QListWidgetItem(task_text)
        item.setFlags(item.flags() | Qt.ItemIsUserCheckable)
        item.setCheckState(Qt.Checked if completed else Qt.Unchecked)
        self.tasks_list.addItem(item)

    def edit_task(self, item):
        old_text = item.text()
        new_text, ok = QInputDialog.getText(self, "×¢×¨×™×›×ª ××©×™××”", "×¢×¨×•×š ××©×™××”:", text=old_text)
        if ok and new_text:
            item.setText(new_text)

    def edit_selected_task(self):
        current_item = self.tasks_list.currentItem()
        if current_item:
            self.edit_task(current_item)
        else:
            QMessageBox.warning(self, "××–×”×¨×”", "×× × ×‘×—×¨ ××©×™××” ×œ×¢×¨×™×›×”")

    def delete_selected_task(self):
        current_item = self.tasks_list.currentItem()
        if current_item:
            reply = QMessageBox.question(self, '××—×™×§×ª ××©×™××”', 
                                         "×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×™××” ×”×–×•?",
                                         QMessageBox.Yes | QMessageBox.No, QMessageBox.No)
            if reply == QMessageBox.Yes:
                self.tasks_list.takeItem(self.tasks_list.row(current_item))
        else:
            QMessageBox.warning(self, "××–×”×¨×”", "×× × ×‘×—×¨ ××©×™××” ×œ××—×™×§×”")

    def add_changelog_tasks(self):
        changelog_tasks = [
            "×”×•×¡×¤×ª ×ª××™×›×” ×‘××¡×¤×¨ ×©×¤×•×ª ×¢× ××¤×©×¨×•×™×•×ª ×œ×¢×‘×¨×™×ª ×•×× ×’×™×ª",
            "×”×•×¡×¤×ª ×××©×§ ×©×•×¨×ª ×¤×§×•×“×” ×œ×“ ×××©×§ ×”××©×ª××© ×”×’×¨×¤×™",
            "×©×™×œ×•×‘ ×™×›×•×œ×•×ª ×•×™×–×•××œ×™×–×¦×™×” ×©×œ × ×ª×•× ×™× ×¢×‘×•×¨ ×ª×•×¦××•×ª ×ª×§×™×¤×” ×•××™×¤×•×™ ×¨×©×ª",
            "×¤×™×ª×•×— ××¢×¨×›×ª × ×™×”×•×œ ×ª×•×¡×¤×™× ××ª×§×“××ª",
            "×”×•×¡×¤×ª ×¢×•×¨×š ×˜×§×¡×˜ ××•×‘× ×” ×œ×¢×¨×™×›×ª ×¡×§×¨×™×¤×˜×™×",
            "×™×¦×™×¨×ª ×›×œ×™ ×œ×’×™×œ×•×™ ×•××™×¤×•×™ ×¨×©×ª×•×ª",
            "×”×•×¡×¤×ª ××—×•×œ×œ ×“×•×—×•×ª ××§×¦×•×¢×™ ×¢×‘×•×¨ ×“×•×—×•×ª ×‘×“×™×§×ª ×—×“×™×¨×”",
            "×©×™×¤×•×¨ ×’××™×©×•×ª ×•×™×›×•×œ×ª ×¢×’×™× ×” ×©×œ ×—×œ×§×™ ×××©×§ ×”××©×ª××©",
            "×”×•×¡×¤×ª × ×™×¤×•×™ ×‘××’×™× ×‘×˜×¨××™× ×œ ×œ×¦×“ ×”×¨×™×©×•× ×”×§×™×™×",
            "×™×™×©×•× ××¢×¨×›×ª ×ª×•×¡×¤×™× ×‘×¡×™×¡×™×ª ×œ×”×¨×—×‘×ª ×¤×•× ×§×¦×™×•× ×œ×™×•×ª",
            "×©×™×¤×•×¨ ×”×™×•××Ÿ ×¢× ×¡×™××•×Ÿ ×”×©×œ××ª ××©×™××•×ª ×•×”×•×¡×¤×ª ××©×™××•×ª ×—×“×©×•×ª",
            "×”×•×¡×¤×ª ×§×•×‘×¥ CHANGELOG ××œ× ××’×¨×¡×” 0.1.0 ×•×¢×“ ×›×”",
            "×™×™×¨×ª ×¡×¤×¨×™×” ×œ×¡×§×¨×™×¤×˜×™ ×§×™×¤×” ××§×•×˜×œ×’×™× ×œ×¤×™ ×¡×•×’",
            "×™×™×©×•× ×¢×™×¦×•×‘ ×××©×§ ××©×ª××© ××•×“×¨× ×™ ×‘×¡×’× ×Ÿ '×–×›×™×ª ××¢×•×¨×¤×œ×ª' ×©×§×•×£ ×œ××—×¦×”",
            "×”×•×¡×¤×ª ×¢×¨×›×ª ×¦×‘×¢×™× ×›×”×” ×¢× ×©×§×™×¤×•×ª",
            "×”×˜××¢×ª × ×™×”×•×œ ×™×•××Ÿ ××‘×•×¡×¡ JSON ×¢× ×˜×¢× ×” ××•×˜×•××˜×™×ª",
            "×™×¦×™×¨×ª ×§×‘×¦×™ JSON ×™×™×¢×•×“×™×™× ×œ×›×œ ××˜×¨×” ×‘×¡×¤×¨×™×™×ª ××˜×¨×•×ª ×™×™×¢×•×“×™×ª",
            "×”×•×¡×¤×ª ×¨×©×™××ª ××˜×¨×•×ª ×¢× ××¤×©×¨×•×ª ×’×œ×™×œ×” ×•×™×›×•×œ×ª ×œ×¦×¤×•×ª ×•×œ× ×”×œ ×ª×”×œ×™×›×™ ××˜×¨×”",
            "×”×•×¡×¤×ª ×—×œ×•×Ÿ × ×™×¤×•×™ ×‘××’×™× ×œ× ×™×˜×•×¨ ×ª×•×›× ×™×ª ×‘×–××Ÿ ×××ª",
            "×™×™×©×•× ×¨×™×©×•× ×¤×¢×™×œ×•×ª ×•×©××™×¨×” ×‘×ª×™×§×™×™×” ×“×•×—×•×ª",
            "×”×•×¡×¤×ª ××¤×©×¨×•×ª ×œ×©×™×™× ×•×œ× ×”×œ ××˜×¨×•×ª ×›×ª×”×œ×™×›×™× ××ª××©×›×™×",
            "×¢×“×›×•×Ÿ ×§×¨×“×™×˜×™× ×œ×›×œ×•×œ ××ª ×›×œ ×”××¤×ª×—×™×",
            "×”×•×¡×¤×ª ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×ª×§×™×¤×•×ª ××œ×—×•×˜×™×•×ª",
            "×©×™×¤×•×¨ ×ª×’×•×‘×ª×™×•×ª ×××©×§ ×”××©×ª××© ×”×’×¨×¤×™",
            "×”×•×¡×¤×ª ×¡×¨×’×œ ×”×ª×§×“××•×ª ×¢×‘×•×¨ ×¤×¢×•×œ×•×ª ××¨×•×›×•×ª",
            "×™×©×•× ×˜×™×¤×•×œ ×‘×¡×™×¡×™ ×‘×©×’×™××•×ª",
            "×”×•×¡×¤×ª ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×ª×§×™×¤×” ×•× ×™×¦×•×œ ×©×œ ××¤×œ×™×§×¦×™×•×ª ×™× ×˜×¨× ×˜",
            "×©×™×¤×•×¨ ×¤×¨×™×¡×ª ×××©×§ ×”××©×ª××© ×”×’×¨×¤×™",
            "×”×•×¡×¤×ª ×©×•×¨×ª ×¡×˜×˜×•×¡ ×œ×”×¦×’×ª ×”×¤×¢×•×œ×” ×”× ×•×›×—×™×ª",
            "×™×™×©×•× ×‘×¡×™×¡×™ ×©×œ ×××©×§ ××©×ª××© ×’×¨×¤×™ ×¢× PyQt5",
            "×™×™×©×•× ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×œ×™×‘×”: ×¡×™×•×¨ ××§×“×™×, × ×™×¦×•×œ, ×ª× ×•×¢×” ×¨×•×—×‘×™×ª, ×”×ª××“×”, ×“×™×•×•×—",
            "×”×’×“×¨×ª ×¤×¨×•×™×§×˜ ×¨××©×•× ×™×ª",
            "××‘× ×” ×¤×¨×•×™×§×˜ ×‘×¡×™×¡×™ ×•-README"
        ]
        for task in changelog_tasks:
            self.add_task_to_list(task, True)  # True indicates the task is completed

class DebugWindow(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("×—×œ×•×Ÿ ×“×™×‘×•×’")
        self.setGeometry(200, 200, 500, 300)
        self.initUI()

    def initUI(self):
        layout = QVBoxLayout()
        self.debug_text = QTextEdit()
        self.debug_text.setReadOnly(True)
        layout.addWidget(self.debug_text)
        self.setLayout(layout)

    def log(self, message):
        self.debug_text.append(f"{datetime.datetime.now()}: {message}")

class TargetProfileDialog(QDialog):
    def __init__(self, target_name, parent=None):
        super().__init__(parent)
        self.setWindowTitle(f"×¤×¨×•×¤×™×œ ××˜×¨×” - {target_name}")
        self.setGeometry(200, 200, 500, 400)
        self.target_name = target_name
        self.target_file = f"targets/{target_name}.json"
        self.initUI()
        self.load_target_data()

    def initUI(self):
        layout = QVBoxLayout()

        form_layout = QFormLayout()
        self.name_input = QLineEdit()
        self.ip_input = QLineEdit()
        self.website_input = QLineEdit()
        self.phone_input = QLineEdit()
        self.email_input = QLineEdit()  # ×—×“×©
        self.location_input = QLineEdit()  # ×—×“×©
        self.os_input = QLineEdit()  # ×—×“×©
        self.profiles_input = QTextEdit()
        self.notes_input = QTextEdit()  # ×—×“×©

        form_layout.addRow("×©×:", self.name_input)
        form_layout.addRow("×›×ª×•×‘×ª IP:", self.ip_input)
        form_layout.addRow("××ª×¨:", self.website_input)
        form_layout.addRow("×˜×œ×¤×•×Ÿ:", self.phone_input)
        form_layout.addRow("××™××™×™×œ:", self.email_input)
        form_layout.addRow("××™×§×•×:", self.location_input)
        form_layout.addRow("××¢×¨×›×ª ×”×¤×¢×œ×”:", self.os_input)
        form_layout.addRow("×¤×¨×•×¤×™×œ×™× ×¦×™×‘×•×¨×™×™×:", self.profiles_input)
        form_layout.addRow("×”×¢×¨×•×ª:", self.notes_input)

        layout.addLayout(form_layout)

        button_layout = QHBoxLayout()
        update_button = QPushButton("×¢×“×›×Ÿ ×¤×¨×•×¤×™×œ")
        update_button.clicked.connect(self.update_profile)
        button_layout.addWidget(update_button)

        delete_button = QPushButton("××— ××˜×¨×”")
        delete_button.clicked.connect(self.delete_target)
        button_layout.addWidget(delete_button)

        layout.addLayout(button_layout)

        self.setLayout(layout)

    def load_target_data(self):
        try:
            if os.path.exists(self.target_file):
                with open(self.target_file, 'r', encoding='utf-8') as f:
                    target_data = json.load(f)
                    self.name_input.setText(target_data.get('name', ''))
                    self.ip_input.setText(target_data.get('ip', ''))
                    self.website_input.setText(target_data.get('website', ''))
                    self.phone_input.setText(target_data.get('phone', ''))
                    self.email_input.setText(target_data.get('email', ''))
                    self.location_input.setText(target_data.get('location', ''))
                    self.os_input.setText(target_data.get('os', ''))
                    self.profiles_input.setPlainText(target_data.get('profiles', ''))
                    self.notes_input.setPlainText(target_data.get('notes', ''))
        except Exception as e:
            print(f"Error loading target data: {e}")

    def update_profile(self):
        try:
            target_data = {
                'name': self.name_input.text(),
                'ip': self.ip_input.text(),
                'website': self.website_input.text(),
                'phone': self.phone_input.text(),
                'email': self.email_input.text(),
                'location': self.location_input.text(),
                'os': self.os_input.text(),
                'profiles': self.profiles_input.toPlainText(),
                'notes': self.notes_input.toPlainText(),
                'last_updated': datetime.datetime.now().isoformat()
            }
            
            # Create targets directory if it doesn't exist
            os.makedirs('targets', exist_ok=True)
            
            with open(self.target_file, 'w', encoding='utf-8') as f:
                json.dump(target_data, f, ensure_ascii=False, indent=2)
            
            QMessageBox.information(self, "×¢×“×›×•×Ÿ", "×¤×¨×•×¤×™×œ ×”××˜×¨×” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!")
            self.accept()  # Close the dialog after successful update
        except Exception as e:
            QMessageBox.critical(self, "×©×’×™××”", f"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¤×¨×•×¤×™×œ ×”××˜×¨×”: {str(e)}")

    def delete_target(self):
        reply = QMessageBox.question(self, '××—×™×§×ª ××˜×¨×”', 
                                     f"×”×× ×ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××˜×¨×” {self.target_name}?",
                                     QMessageBox.Yes | QMessageBox.No, QMessageBox.No)
        if reply == QMessageBox.Yes:
            if os.path.exists(self.target_file):
                os.remove(self.target_file)
                QMessageBox.information(self, "××—×™×§×”", "×”××˜×¨×” × ××—×§×” ×‘×”×¦×œ×—×”!")
                self.parent().load_targets()  # ×¨×¢× ×•×Ÿ ×¨×©×™××ª ×”××˜×¨×•×ª
                self.close()
            else:
                QMessageBox.warning(self, "×©×’×™××”", "×§×•×‘×¥ ×”××˜×¨×” ×œ× × ××¦×!")

class AsyncWorker(QRunnable):
    class Signals(QObject):
        finished = pyqtSignal(str)
        error = pyqtSignal(str)

    def __init__(self, coro):
        super().__init__()
        self.coro = coro
        self.signals = self.Signals()

    def run(self):
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        try:
            result = loop.run_until_complete(self.coro)
            self.signals.finished.emit(result)
        except Exception as e:
            self.signals.error.emit(str(e))
        finally:
            loop.close()

class SummaryDialog(QDialog):
    def __init__(self, title, content, parent=None):
        super().__init__(parent)
        self.setWindowTitle(title)
        self.setGeometry(200, 200, 600, 400)
        self.initUI(content)

    def initUI(self, content):
        layout = QVBoxLayout()
        scroll = QScrollArea()
        content_widget = QWidget()
        content_layout = QVBoxLayout(content_widget)

        summary_label = QLabel(content)
        summary_label.setWordWrap(True)
        summary_label.setStyleSheet("text-align: left; direction: ltr;")
        
        content_layout.addWidget(summary_label)
        content_widget.setLayout(content_layout)
        scroll.setWidget(content_widget)
        scroll.setWidgetResizable(True)
        layout.addWidget(scroll)

        close_button = QPushButton("×¡×’×•×¨")
        close_button.clicked.connect(self.close)
        layout.addWidget(close_button)

        self.setLayout(layout)

class SocialEngineeringDialog(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("×”× ×“×¡×” ×—×‘×¨×ª×™×ª")
        self.setGeometry(200, 200, 400, 300)
        self.initUI()

    def initUI(self):
        layout = QVBoxLayout()

        # ××¤×©×¨×•×™×•×ª ×—×™×¤×•×©
        search_group = QGroupBox("××¤×©×¨×•×™×•×ª ×—×™×¤×•×©")
        search_layout = QVBoxLayout()
        self.phone_radio = QRadioButton("×—×™×¤×•×© ×œ×¤×™ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ")
        self.nickname_radio = QRadioButton("×—×™×¤×•×© ×œ×¤×™ ×›×™× ×•×™")
        self.phone_radio.setChecked(True)
        search_layout.addWidget(self.phone_radio)
        search_layout.addWidget(self.nickname_radio)
        search_group.setLayout(search_layout)
        layout.addWidget(search_group)

        # ×©×“×” ×§×œ×˜
        self.search_input = QLineEdit()
        layout.addWidget(QLabel("×”×–×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ××• ×›×™× ×•×™:"))
        layout.addWidget(self.search_input)

        # ×›×¤×ª×•×¨ ×—×™×¤×•×©
        search_button = QPushButton("×—×¤×©")
        search_button.clicked.connect(self.perform_search)
        layout.addWidget(search_button)

        # ××–×•×¨ ×ª×•×¦××•×ª
        self.results_area = QTextEdit()
        self.results_area.setReadOnly(True)
        layout.addWidget(QLabel("×ª×•×¦××•×ª:"))
        layout.addWidget(self.results_area)

        self.setLayout(layout)

    def perform_search(self):
        search_type = "phone" if self.phone_radio.isChecked() else "nickname"
        search_term = self.search_input.text()
        
        # ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×-social_engineering_script.py
        from Menu_Attacks.social_engineering_script import run_search
        results = run_search(search_type, search_term)
        
        self.results_area.setText(results)

class HacKingProGUI(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("HacKingPro v0.3.1 ğŸ›¡ï¸")  # ×¢×“×›×•×Ÿ ××¡×¤×¨ ×”×’×¨×¡×”
        self.setGeometry(100, 100, 1200, 800)
        
        self.is_admin_mode = False
        
        # Set window background to be semi-transparent
        self.setAttribute(Qt.WA_TranslucentBackground)
        self.setStyleSheet("""
            QMainWindow {
                background-color: rgba(20, 20, 20, 200);
            }
        """)
        
        self.debug_window = DebugWindow()
        self.current_target = None
        self.plugins = {}
        self.tool_buttons = {}  # Initialize tool_buttons here
        self.load_plugins()
        self.initUI()
        self.load_layout_settings()
        self.threadpool = QThreadPool()
        self.update_timer = QTimer()
        self.update_timer.timeout.connect(self.update_ui)
        self.update_timer.start(1000)  # Update every second
        self.system_monitor_window = None
        self.debug_window = DebugWindow()
        self.open_system_monitor()
        self.open_debug_window()
        self.active_tools = {}  # ××™×œ×•×Ÿ ×©××™×¨×ª ××¦×‘ ×”×›×œ×™×
        self.terminal_window = None

    def initUI(self):
        self.central_widget = CustomWidget()
        self.setCentralWidget(self.central_widget)
        main_layout = QVBoxLayout(self.central_widget)

        # Update the style of the main layout
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        # Create main horizontal splitter
        main_splitter = QSplitter(Qt.Horizontal)

        # Update the style of the splitters
        splitter_style = """
            QSplitter::handle {
                background-color: rgba(255, 255, 255, 30);
            }
            QSplitter::handle:hover {
                background-color: rgba(255, 255, 255, 50);
            }
        """
        main_splitter.setStyleSheet(splitter_style)

        # Left menu (English)
        left_menu = QWidget()
        self.left_layout = QVBoxLayout(left_menu)

        # Attack menu (English)
        attack_menu = self.create_framed_menu("Attack Menu", [
            ("Reconnaissance ğŸ”", self.reconnaissance),
            ("Exploitation ğŸ’¥", self.exploitation),
            ("Lateral Movement ğŸ”€", self.lateral_movement),
            ("Persistence ğŸ”’", self.persistence),
            ("Reporting ğŸ“Š", self.reporting),
            ("Web App Attack ğŸŒ", self.web_app_attack),
            ("Wireless Attacks ğŸ“¡", self.wireless_attacks),
            ("Sniffing and Decryption ğŸ‘ƒ", self.sniffing_decryption),
            ("Social Engineering ğŸ­", self.social_engineering),
            ("Password Attacks ğŸ”‘", self.password_attacks),
            ("Hardware Hacking ğŸ”§", self.hardware_hacking),
            ("Maintaining Access ğŸšª", self.maintaining_access)
        ])
        self.left_layout.addWidget(attack_menu)

        # Plugins menu
        plugins_menu = self.create_framed_menu("Plugins ğŸ§©", [])
        plugins_layout = plugins_menu.layout()

        # Add plugin buttons
        for plugin_name, plugin in self.plugins.items():
            if plugin_name == "example_plugin":
                self.add_plugin_button(plugins_layout, "Example Plugin ğŸ§©", self.run_example_plugin)
            else:
                self.add_plugin_button(plugins_layout, f"{plugin_name.replace('_', ' ').title()} ğŸ§©", lambda _, p=plugin: self.run_plugin(p))

        self.left_layout.addWidget(plugins_menu)

        main_splitter.addWidget(left_menu)

        # Central area
        central_widget = QWidget()
        central_layout = QVBoxLayout(central_widget)

        # Create a horizontal layout for dashboard, system monitor, and network monitor
        dashboard_monitor_layout = QHBoxLayout()

        # Wrap the intro widget in a frame
        intro_widget = get_intro_widget()
        intro_frame = self.create_framed_widget("Dashboard ğŸ“Š", intro_widget)
        dashboard_monitor_layout.addWidget(intro_frame)

        # Add system monitor
        text_monitor = TextSystemMonitorWidget()
        monitor_frame = self.create_framed_widget("System Monitor ğŸ“Š", text_monitor)
        dashboard_monitor_layout.addWidget(monitor_frame)

        # Add network monitor
        try:
            network_monitor = NetworkMonitorWidget()
            network_monitor_frame = self.create_framed_widget("Network Monitor ğŸŒ", network_monitor)
            dashboard_monitor_layout.addWidget(network_monitor_frame)
        except Exception as e:
            print(f"Error initializing Network Monitor: {e}")
            self.debug_window.log(f"Error initializing Network Monitor: {e}")

        central_layout.addLayout(dashboard_monitor_layout)

        # Output area and progress bar
        output_frame = self.create_framed_widget("Output ğŸ“‹", QWidget())
        output_widget = output_frame.layout().itemAt(0).widget()
        output_layout = QVBoxLayout(output_widget)
        
        self.output_area = QTextEdit()
        self.output_area.setReadOnly(True)
        self.output_area.setStyleSheet("background-color: rgba(30, 30, 30, 128); color: rgba(255, 255, 255, 128);")
        output_layout.addWidget(self.output_area)
        
        self.progress_bar = QProgressBar()
        self.progress_bar.setVisible(False)
        self.progress_bar.setStyleSheet("background-color: rgba(60, 60, 60, 128); color: rgba(255, 255, 255, 128);")
        output_layout.addWidget(self.progress_bar)

        # Target management area
        target_management_layout = QHBoxLayout()

        # Target list
        targets_frame = self.create_framed_widget("Target List ğŸ“‹", QListWidget())
        self.targets_list = targets_frame.layout().itemAt(0).widget()
        self.targets_list.setStyleSheet("background-color: rgba(30, 30, 30, 128); color: rgba(255, 255, 255, 128);")
        self.targets_list.itemClicked.connect(self.set_current_target)
        target_management_layout.addWidget(targets_frame)

        # Now we can safely load targets because output_area exists
        self.load_targets()

        # Target details
        target_details_frame = self.create_framed_widget("Target Details ğŸ¯", QTextEdit())
        self.target_details = target_details_frame.layout().itemAt(0).widget()
        self.target_details.setReadOnly(True)
        self.target_details.setStyleSheet("background-color: rgba(30, 30, 30, 128); color: rgba(255, 255, 255, 128);")
        target_management_layout.addWidget(target_details_frame)

        central_layout.addLayout(target_management_layout)

        main_splitter.addWidget(central_widget)

        # Right menu (Hebrew)
        right_menu = QWidget()
        self.right_layout = QVBoxLayout(right_menu)

        # Tools menu (Hebrew)
        tools_menu = self.create_framed_menu("×ª×¤×¨×™×˜ ×›×œ×™×", [
            ("×™×•××Ÿ ğŸ“", self.show_journal),
            ("×“×™×‘×•×’ ğŸ", self.show_debug),
            ("× ×™×”×•×œ ××˜×¨×•×ª ğŸ¯", self.manage_target),
            ("×¢×–×¨×” â“", self.show_help),
            ("×”×¦×’/×©××•×¨ ××™×§×•××™× ğŸ“", self.show_save_layout)
        ])
        self.right_layout.addWidget(tools_menu)

        # New features menu
        new_features_menu = self.create_framed_menu("×ª×›×•× ×•×ª ×—×“×©×•×ª ğŸ†•", [
            ("×¤×ª×— ×××©×§ ×©×•×¨×ª ×¤×§×•×“×” ğŸ’»", self.open_cli),
            ("×•×™×–×•××œ×™×–×¦×™×” ×©×œ × ×ª×•× ×™× ğŸ“Š", self.show_data_visualization),
            ("×× ×”×œ ×ª×•×¡×¤×™× ğŸ§©", self.open_plugin_manager),
            ("×¢×•×¨×š ×¡×§×¨×™×¤×˜×™× âœï¸", self.open_text_editor),
            ("×’×™×œ×•×™ ×¨×©×ª ğŸ—ºï¸", self.run_network_discovery),
            ("×™×¦×™×¨×ª ×“×•×— ğŸ“‘", self.generate_report)
        ])
        self.right_layout.addWidget(new_features_menu)

        # ×”×•×¡×¤×ª ×›×¤×ª×•×¨ ××¦×‘ ×× ×”×œ
        self.admin_mode_button = QPushButton("ğŸ”’ ××¦×‘ ×¨×’×™×œ")
        self.admin_mode_button.clicked.connect(self.toggle_admin_mode)
        self.right_layout.addWidget(self.admin_mode_button)

        main_splitter.addWidget(right_menu)

        main_layout.addWidget(main_splitter)

        # Status bar
        self.status_bar = QStatusBar()
        self.status_bar.setStyleSheet("background-color: rgba(30, 30, 30, 200); color: white;")
        self.setStatusBar(self.status_bar)

        # Add clock to status bar
        self.clock_label = QLabel()
        self.status_bar.addPermanentWidget(self.clock_label)
        self.update_clock()

        # Add target indicator to status bar
        self.target_indicator = QLabel("ğŸ”“ No Target")
        self.status_bar.addPermanentWidget(self.target_indicator)

        # Start clock timer
        self.clock_timer = QTimer(self)
        self.clock_timer.timeout.connect(self.update_clock)
        self.clock_timer.start(1000)

        self.load_targets()

        # Add new features for version 0.2.0
        self.add_language_support()

    def update_ui(self):
        self.update_clock()
        # Add other periodic updates here

    def update_clock(self):
        current_time = QDateTime.currentDateTime()
        time_display = current_time.toString('yyyy-MM-dd hh:mm:ss')
        self.clock_label.setText(time_display)

    def create_framed_menu(self, title, buttons):
        frame = QGroupBox(title)
        frame.setStyleSheet("""
            QGroupBox {
                background-color: rgba(30, 30, 30, 150);
                border: 1px solid rgba(255, 255, 255, 50);
                border-radius: 10px;
                margin-top: 1ex;
                font-weight: bold;
                font-size: 14px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                subcontrol-position: top center;
                padding: 0 3px;
                color: white;
            }
        """)
        layout = QVBoxLayout(frame)
        for text, func in buttons:
            if title == "Attack Menu":
                button = QPushButton(f"ğŸ”´ {text}")
                self.tool_buttons[text.split()[0].lower()] = button
            else:
                button = QPushButton(text)
            button.setFont(QFont("Arial", 10))
            button.clicked.connect(func)
            button.setStyleSheet("""
                QPushButton {
                    background-color: rgba(60, 60, 60, 150);
                    color: white;
                    border: 1px solid rgba(255, 255, 255, 30);
                    border-radius: 5px;
                    padding: 5px;
                    text-align: left;
                }
                QPushButton:hover {
                    background-color: rgba(80, 80, 80, 180);
                }
                QPushButton:pressed {
                    background-color: rgba(40, 40, 40, 180);
                }
            """)
            layout.addWidget(button)
        return frame

    def load_plugins(self):
        plugins_dir = "plugins"
        if not os.path.exists(plugins_dir):
            os.makedirs(plugins_dir)
        sys.path.append(plugins_dir)
        
        # Use a dictionary comprehension for faster plugin loading
        self.plugins = {
            file[:-3]: importlib.import_module(file[:-3])
            for file in os.listdir(plugins_dir)
            if file.endswith(".py") and not file.startswith("__")
            and hasattr(importlib.import_module(file[:-3]), 'run')
        }

    def run_plugin(self, plugin):
        try:
            if hasattr(plugin, 'get_widget'):
                widget = plugin.get_widget()
                dock = QDockWidget(f"{plugin.__name__.replace('_', ' ').title()} Plugin", self)
                dock.setWidget(widget)
                self.addDockWidget(Qt.RightDockWidgetArea, dock)
                self.output_area.append(f"Plugin {plugin.__name__} widget added.\n")
            else:
                result = plugin.run()
                self.output_area.append(f"Plugin result: {result}\n")
        except Exception as e:
            self.output_area.append(f"Error running plugin: {e}\n")

    def load_targets(self):
        self.targets_list.clear()
        
        # Create targets directory if it doesn't exist
        if not os.path.exists('targets'):
            os.makedirs('targets')
            if hasattr(self, 'output_area'):
                self.output_area.append("× ×•×¦×¨×” ×ª×™×§×™×™×ª targets ×—×“×©×”\n")
            return

        try:
            # Get list of all json files in targets directory
            target_files = [f for f in os.listdir('targets') if f.endswith('.json')]
            
            if not target_files:
                if hasattr(self, 'output_area'):
                    self.output_area.append("×œ× × ××¦××• ××˜×¨×•×ª\n")
                return

            for file in target_files:
                try:
                    with open(os.path.join('targets', file), 'r', encoding='utf-8') as f:
                        target_data = json.load(f)
                        target_name = file[:-5]  # Remove .json extension
                        item = QListWidgetItem(target_name)
                        self.targets_list.addItem(item)
                        if hasattr(self, 'output_area'):
                            self.output_area.append(f"× ×˜×¢× ×” ××˜×¨×”: {target_name}\n")
                except Exception as e:
                    if hasattr(self, 'output_area'):
                        self.output_area.append(f"×©×’×™××” ×‘×˜×¢×™× ×ª {file}: {str(e)}\n")
                    print(f"Error loading target {file}: {e}")

        except Exception as e:
            if hasattr(self, 'output_area'):
                self.output_area.append(f"×©×’×™××” ×‘×˜×¢×™× ×ª ×”××˜×¨×•×ª: {str(e)}\n")
            print(f"Error loading targets: {e}")

    def set_current_target(self, item):
        self.current_target = item.text()
        target_file = f"targets/{self.current_target}.json"
        if os.path.exists(target_file):
            with open(target_file, 'r', encoding='utf-8') as f:
                target_data = json.load(f)
                self.current_target_ip = target_data.get('ip', '')
        else:
            self.current_target_ip = ''
        
        if not self.current_target_ip:
            QMessageBox.warning(self, "××–×”×¨×”", f"×›×ª×•×‘×ª IP ×œ× ×”×•×’×“×¨×” ×¢×‘×•×¨ ×”××˜×¨×” '{self.current_target}'. ×× × ×¢×“×›×Ÿ ××ª ×¤×¨×˜×™ ×”××˜×¨×”.")
        
        self.target_indicator.setText(f"ğŸ”’ Target: {self.current_target} ({self.current_target_ip})")
        self.output_area.append(f"××˜×¨×” × ×•×›×—×™×ª × ×‘×—×¨×”: {self.current_target} ({self.current_target_ip})\n")
        self.debug_window.log(f"××˜×¨×” × ×•×›×—×™×ª × ×‘×—×¨×”: {self.current_target} ({self.current_target_ip})")
        self.log_activity(f"××˜×¨×” × ×•×›×—×™×ª × ×‘×—×¨×”: {self.current_target} ({self.current_target_ip})")
        self.show_target_profile(item)

    def show_target_profile(self, item):
        target_name = item.text()
        target_file = f"targets/{target_name}.json"
        if os.path.exists(target_file):
            with open(target_file, 'r', encoding='utf-8') as f:
                target_data = json.load(f)
                details = f"""×©×: {target_data.get('name', '')}
×›×ª×•×‘×ª IP: {target_data.get('ip', '')}
××ª×¨: {target_data.get('website', '')}
×˜×œ×¤×•×Ÿ: {target_data.get('phone', '')}
××™××™×™×œ: {target_data.get('email', '')}
××™×§×•×: {target_data.get('location', '')}
××¢×¨×›×ª ×”×¤×¢×œ×”: {target_data.get('os', '')}
×¤×¨×•×¤×™×œ×™× ×¦×™×‘×•×¨×™×™×:
{target_data.get('profiles', '')}
×”×¢×¨×•×ª:
{target_data.get('notes', '')}
×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: {target_data.get('last_updated', '')}"""
                self.target_details.setPlainText(details)
        else:
            self.target_details.setPlainText("×œ× × ××¦× ××™×“×¢ ×¢×œ ×”××˜×¨×”")

    def start_operation(self, operation_name):
        if not self.current_target:
            QMessageBox.warning(self, "××–×”×¨×”", "×× × ×‘×—×¨ ××˜×¨×” ×œ×¤× ×™ ×‘×™×¦×•×¢ ×¤×¢×•×œ×”.")
            return

        settings_dialog = OperationSettingsDialog(operation_name, self)
        if settings_dialog.exec_() == QDialog.Accepted:
            settings = settings_dialog.get_settings()
            
            self.output_area.append(f"××‘×¦×¢ {operation_name}...\n")
            self.status_bar.showMessage(f"××‘×¦×¢ {operation_name}...")
            self.progress_bar.setVisible(True)
            self.progress_bar.setValue(0)
            
            self.timer = QTimer()
            self.timer.timeout.connect(self.update_progress)
            self.timer.start(100)

            self.debug_window.log(f"×”×ª×—×ª ×¤×¢×•×œ×”: {operation_name}")
            self.log_activity(f"×”×ª×—×œ×ª ×¤×¢×œ×”: {operation_name}")

            tool_name = operation_name.lower().replace(" ", "_")
            self.set_tool_status(tool_name, "active")

            self.run_operation(operation_name, settings)
        else:
            self.output_area.append(f"×¤×¢×•×œ×” {operation_name} ×‘×•×˜×œ×”.\n")

    def run_operation(self, operation_name, settings):
        if operation_name == "×¡×¨×™×§×”":
            self.run_scan(settings)
        elif operation_name == "× ×™×¦×•×œ":
            self.run_exploitation(settings)
        elif operation_name == "×ª× ×•×¢×” ×¨×•×—×‘×™×ª":
            self.run_lateral_movement(settings)
        elif operation_name == "×”×ª××“×”":
            self.run_persistence(settings)
        elif operation_name == "×“×™×•×•×—":
            self.run_reporting(settings)
        # ×”×•×¡×£ ×›××Ÿ ×ª× ××™× × ×•×¡×¤×™× ×œ×¤×¢×•×œ×•×ª ××—×¨×•×ª

    def run_scan(self, settings):
        scan_type = settings.get('scan_type', '1')
        if self.current_target_ip:
            if self.is_admin_mode:
                self.output_area.append("××‘×¦×¢ ×¡×¨×™×§×” ×¢× ×”×¨×©××•×ª ×× ×”×œ...")
                self.run_with_admin(self.run_attack_script, "reconnaissance", self.current_target_ip, scan_type)
            else:
                self.run_attack_script("reconnaissance", self.current_target_ip, scan_type)
        else:
            error_msg = f"×©×’×™××”: ×›×ª×•×‘×ª IP ×©×œ ×”××˜×¨×” '{self.current_target}' ×œ× ×”×•×’×“×¨×”."
            self.output_area.append(error_msg)
            self.debug_window.log(error_msg)

    def run_exploitation(self, settings):
        exploit = settings.get('exploit', '')
        self.run_attack_script("exploitation", self.current_target, exploit)

    def run_lateral_movement(self, settings):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×œ×•×’×™×§×” ×œ×ª× ×•×¢×” ×¨×•×—×‘×™×ª
        pass

    def run_persistence(self, settings):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×œ×•×’×™×§×” ×œ×”×ª××“×”
        pass

    def run_reporting(self, settings):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×œ×•×’×™×§×” ×œ×“×™×•×•×—
        pass

    def update_progress(self):
        current_value = self.progress_bar.value()
        if current_value < 100:
            self.progress_bar.setValue(current_value + 1)
        else:
            self.timer.stop()
            self.progress_bar.setVisible(False)
            self.status_bar.showMessage("×”×¤×¢×•×œ×” ×”×•×©×œ××”", 3000)
            self.debug_window.log("×”×¤×¢×•×œ×” ×”×•×©×œ××”")
            self.log_activity("×”×¤×¢×•×œ×” ×”×•×©×œ××”")
            # ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×›×œ×™ ×œ×™×¨×•×§ ×›×©×”×¤×¢×•×œ×” ×”×•×©×œ××”
            for tool, status in self.active_tools.items():
                if status == "active":
                    self.set_tool_status(tool, "completed")

    def reconnaissance(self):
        if not self.current_target:
            QMessageBox.warning(self, "××–×”×¨×”", "×× × ×‘×—×¨ ××˜×¨×” ×œ×¤× ×™ ×‘×™×¦×•×¢ ×¡×¨×™×§×”.")
            return

        scan_types = [
            "1. ×¡×¨×™×§×” ××”×™×¨×” (×¤×•×¨×˜×™× × ×¤×•×¦×™×)",
            "2. ×¡×¨×™×§×” ××œ××” (×›×œ ×”×¤×•×¨×˜×™×)",
            "3. ×¡×¨×™×§×ª ×©×™×¨×•×ª×™× ×•×’×¨×¡××•×ª",
            "4. ×¡×¨×™×§×ª ××¢×¨×›×ª ×”×¤×¢×œ×”"
        ]
        scan_type, ok = QInputDialog.getItem(self, "×‘×—×™×¨×ª ×¡×•×’ ×¡×¨×™×§×”",
                                             "×‘×—×¨ ×¡×•×’ ×¡×¨×™×§×”:",
                                             scan_types, 0, False)
        if ok and scan_type:
            self.start_operation("×¡×¨×™×§×”")
            nmap_command = f"nmap {self.get_nmap_args(scan_type[0])} {self.current_target}"
            self.run_in_terminal(nmap_command)

    def exploitation(self):
        self.start_operation("× ×™×¦×•×œ")
        self.run_attack_script("exploitation")

    def lateral_movement(self):
        self.start_operation("×ª× ×•×¢×” ×¨×•×—×‘×™×ª")
        self.run_attack_script("lateral_movement")

    def persistence(self):
        self.start_operation("×”×ª××“×”")
        self.run_attack_script("persistence")

    def reporting(self):
        self.start_operation("×“×™×•×•×—")
        self.run_attack_script("reporting")

    def web_app_attack(self):
        self.start_operation("×ª×§×™×¤×ª ××¤×œ×™×§×¦×™×™×ª ××™× ×˜×¨× ×˜")
        self.run_attack_script("web_app_attack")

    def wireless_attacks(self):
        self.start_operation("×ª×§×™×¤×•×ª ××œ×—×•×˜×™×•×ª")
        self.run_attack_script("wireless_attacks")

    def show_error(self, message):
        QMessageBox.critical(self, "×©×’×™××”", message)
        self.debug_window.log(f"×©×’××”: {message}")
        self.log_activity(f"×©×’×™××”: {message}")

    def show_help(self):
        help_dialog = HelpDialog(self)
        help_dialog.exec_()

    def show_journal(self):
        journal_dialog = JournalDialog(self)
        journal_dialog.exec_()

    def show_debug(self):
        if self.debug_window.isVisible():
            self.debug_window.hide()
        else:
            self.debug_window.show()

    def manage_target(self):
        target_name, ok = QInputDialog.getText(self, "× ×™×”×•×œ ××˜×¨×•×ª", "×”×–×Ÿ ×©× ×œ××˜×¨×”:")
        if ok and target_name:
            try:
                self.current_target = target_name
                self.output_area.append(f"××˜×¨×” × ×•×›×—×™×ª: {self.current_target}\n")
                self.debug_window.log(f"××˜×¨×” ×—×“×©×” × ×•×¦×¨×”: {self.current_target}")
                self.log_activity(f"××˜×¨×” ×—×“×©×” × ×•×¦×¨×”: {self.current_target}")
                
                target_profile = TargetProfileDialog(target_name, self)
                if target_profile.exec_() == QDialog.Accepted:
                    self.refresh_targets()  # Refresh the list after adding/updating target
                    self.target_indicator.setText(f"ğŸ”’ Target: {target_name}")
                    
                    # Select the newly added target in the list
                    items = self.targets_list.findItems(target_name, Qt.MatchExactly)
                    if items:
                        self.targets_list.setCurrentItem(items[0])
                        self.set_current_target(items[0])
            except Exception as e:
                self.show_error(f"×©×’×™××” ×‘×”×•×¡×¤×ª ××˜×¨×”: {str(e)}")

    def log_activity(self, message):
        log_dir = "activity_logs"
        if not os.path.exists(log_dir):
            os.makedirs(log_dir)
        
        log_file = os.path.join(log_dir, f"{datetime.date.today()}.log")
        with open(log_file, 'a', encoding='utf-8') as f:
            f.write(f"{datetime.datetime.now()}: {message}\n")
        
        # Terminal debugging
        print(f"[DEBUG] {datetime.datetime.now()}: {message}")

    def social_engineering(self):
        self.start_operation("×”× ×“×¡×” ×—×‘×¨×ª×™×ª")
        self.run_attack_script("social_engineering")

    def sniffing_decryption(self):
        self.start_operation("×¡× ×™×¤×” ×•×¤×¢× ×•×—")
        self.run_attack_script("sniffing_decryption")

    def password_attacks(self):
        self.start_operation("×”×ª×§×¤×•×ª ×¡×™×¡×××•×ª")
        self.run_attack_script("password_attacks")

    def hardware_hacking(self):
        self.start_operation("×¤×¨×™×¦×ª ×—×•××¨×”")
        self.run_attack_script("hardware_hacking")

    def maintaining_access(self):
        self.start_operation("×©××™×¨×ª ×’×™×©×”")
        self.run_attack_script("maintaining_access")

    def run_example_plugin(self):
        result = self.plugins["example_plugin"].run()
        self.output_area.append(f"Example Plugin Result: {result}\n")
        QMessageBox.information(self, "Example Plugin", "This is a demonstration of a useful plugin functionality.")

    def get_layout_info(self):
        info = {
            "main_window": {
                "x": self.geometry().x(),
                "y": self.geometry().y(),
                "width": self.geometry().width(),
                "height": self.geometry().height()
            },
            "main_splitter": self.findChild(QSplitter).sizes(),
            "targets_splitter": next((splitter.sizes() for splitter in self.findChildren(QSplitter) if splitter != self.findChild(QSplitter)), None),
            "output_area_height": self.output_area.height(),
            "progress_bar_height": self.progress_bar.height(),
            "targets_list_width": self.targets_list.width(),
            "target_details_width": self.target_details.width()
        }
        return info

    def save_layout_settings(self):
        layout_info = self.get_layout_info()
        with open('layout_settings.json', 'w', encoding='utf-8') as f:
            json.dump(layout_info, f, ensure_ascii=False, indent=2)
        QMessageBox.information(self, "×©××™×¨×ª ×”×’×“×¨×•×ª", "×”×’×“×¨×•×ª ×”××§×•× × ×©××¨×• ×‘×”×¦×œ×—×”!")

    def load_layout_settings(self):
        if os.path.exists('layout_settings.json'):
            with open('layout_settings.json', 'r', encoding='utf-8') as f:
                layout_info = json.load(f)
            self.apply_layout_settings(layout_info)

    def apply_layout_settings(self, layout_info):
        # Main window
        if "main_window" in layout_info:
            self.setGeometry(
                layout_info["main_window"]["x"],
                layout_info["main_window"]["y"],
                layout_info["main_window"]["width"],
                layout_info["main_window"]["height"]
            )
        
        # Main splitter
        if "main_splitter" in layout_info:
            main_splitter = self.findChild(QSplitter)
            if main_splitter:
                main_splitter.setSizes(layout_info["main_splitter"])
        
        # Targets splitter
        if "targets_splitter" in layout_info:
            targets_splitter = next((splitter for splitter in self.findChildren(QSplitter) if splitter != self.findChild(QSplitter)), None)
            if targets_splitter:
                targets_splitter.setSizes(layout_info["targets_splitter"])

    def show_save_layout(self):
        self.save_layout_settings()

    def closeEvent(self, event):
        reply = QMessageBox.question(self, '×¡×’×™×¨×ª ××¤×œ×™×§×¦×™×”',
                                     "×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¡×’×•×¨ ××ª ×”××¤×œ×™×§×¦×™×”?",
                                     QMessageBox.Yes | QMessageBox.No, QMessageBox.No)

        if reply == QMessageBox.Yes:
            self.save_layout_settings()
            if self.system_monitor_window:
                self.system_monitor_window.close()
            self.debug_window.close()
            event.accept()
        else:
            event.ignore()

    def add_plugin_button(self, layout, text, func):
        button = QPushButton(text)
        button.setFont(QFont("Arial", 10))
        button.clicked.connect(func)
        button.setStyleSheet("""
            QPushButton {
                background-color: rgba(60, 60, 60, 150);
                color: white;
                border: 1px solid rgba(255, 255, 255, 30);
                border-radius: 5px;
                padding: 5px;
            }
            QPushButton:hover {
                background-color: rgba(80, 80, 80, 180);
            }
            QPushButton:pressed {
                background-color: rgba(40, 40, 40, 180);
            }
        """)
        layout.addWidget(button)

    def add_language_support(self):
        language_menu = self.menuBar().addMenu("×©×¤×” / Language")
        hebrew_action = QAction("×¢×‘×¨×™×ª", self)
        english_action = QAction("English", self)
        language_menu.addAction(hebrew_action)
        language_menu.addAction(english_action)
        hebrew_action.triggered.connect(lambda: self.change_language("he"))
        english_action.triggered.connect(lambda: self.change_language("en"))

    def change_language(self, lang):
        # Placeholder for language change functionality
        self.output_area.append(f"Changing language to: {lang}\n")

    def open_cli(self):
        # Placeholder for CLI functionality
        self.output_area.append("Opening CLI interface...\n")

    def show_data_visualization(self):
        # Placeholder for data visualization functionality
        self.output_area.append("Showing data visualization...\n")

    def open_plugin_manager(self):
        # Placeholder for plugin manager functionality
        self.output_area.append("Opening plugin manager...\n")

    def open_text_editor(self):
        # Placeholder for text editor functionality
        self.output_area.append("Opening script editor...\n")

    def run_network_discovery(self):
        self.start_operation("×’×™×œ×•×™ ×¨×©×ª")
        network_range = self.get_network_range()
        if network_range:
            self.run_in_terminal(f"sudo netdiscover -r {network_range}")
        else:
            QMessageBox.warning(self, "×©×’×™××”", "×œ× × ×™×ª×Ÿ ×œ×§×‘×•×¢ ××ª ×˜×•×•×— ×”×¨×©×ª. ×× × ×”×–×Ÿ ×˜×•×•×— ×™×“× ×™×ª.")

    def generate_report(self):
        # Placeholder for report generation functionality
        self.output_area.append("Generating pentest report...\n")

    def create_framed_widget(self, title, widget):
        frame = QGroupBox(title)
        frame.setStyleSheet("""
            QGroupBox {
                background-color: rgba(30, 30, 30, 150);
                border: 1px solid rgba(255, 255, 255, 50);
                border-radius: 10px;
                margin-top: 1ex;
                font-weight: bold;
                font-size: 14px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                subcontrol-position: top center;
                padding: 0 3px;
                color: white;
            }
        """)
        layout = QVBoxLayout(frame)
        layout.addWidget(widget)
        return frame

    def run_attack_script(self, category, *args):
        script_path = os.path.join("Menu Attacks", f"{category}_script.py")
        if os.path.exists(script_path):
            try:
                spec = importlib.util.spec_from_file_location(category, script_path)
                module = importlib.util.module_from_spec(spec)
                spec.loader.exec_module(module)
                result = module.run(*args)
                self.output_area.append(result)
            except Exception as e:
                error_msg = f"×©×’×™××” ×‘×”×¨×¦×ª ×¡×§×¨×™×¤×˜ {category}: {str(e)}"
                self.output_area.append(error_msg)
                self.debug_window.log(error_msg)
        else:
            error_msg = f"×¡×§×¨×™×¤×˜ {category} ×œ× × ××¦×."
            self.output_area.append(error_msg)
            self.debug_window.log(error_msg)

    def open_system_monitor(self):
        if not self.system_monitor_window:
            self.system_monitor = SystemMonitorWidget()
            self.system_monitor_window = QMainWindow()
            self.system_monitor_window.setCentralWidget(self.system_monitor)
            self.system_monitor_window.setWindowTitle("System Monitor")
            self.system_monitor_window.setGeometry(100, 100, 600, 800)
        self.system_monitor_window.show()

    def open_debug_window(self):
        self.debug_window.show()

    def toggle_system_monitor(self):
        if self.system_monitor_window.isVisible():
            self.system_monitor_window.hide()
        else:
            self.system_monitor_window.show()

    def set_tool_status(self, tool_name, status):
        if tool_name in self.tool_buttons:
            button = self.tool_buttons[tool_name]
            if status == "active":
                button.setText(f"ğŸŸ  {button.text()[2:]}")
                button.setStyleSheet(button.styleSheet() + "QPushButton { color: #FFA500; }")
            elif status == "completed":
                button.setText(f"ğŸŸ¢ {button.text()[2:]}")
                button.setStyleSheet(button.styleSheet() + "QPushButton { color: #00FF00; }")
            else:  # inactive
                button.setText(f"ğŸ”´ {button.text()[2:]}")
                button.setStyleSheet(button.styleSheet() + "QPushButton { color: #FF0000; }")
        self.active_tools[tool_name] = status

    def run_in_terminal(self, command):
        if not self.terminal_window:
            self.terminal_window = TerminalWindow(self)
        self.terminal_window.show()
        self.terminal_window.run_command(command)

    def get_nmap_args(self, scan_type):
        if scan_type == '1':
            return "-F"
        elif scan_type == '2':
            return "-p-"
        elif scan_type == '3':
            return "-sV"
        elif scan_type == '4':
            return "-O"
        else:
            return "-F"

    def get_network_range(self):
        try:
            # Get the default gateway
            result = subprocess.run(['ip', 'route', 'show', 'default'], capture_output=True, text=True)
            default_gateway = re.search(r'default via (\d+\.\d+\.\d+\.\d+)', result.stdout).group(1)
            
            # Get the network interface
            interface = re.search(r'dev (\w+)', result.stdout).group(1)
            
            # Get the IP address and netmask
            result = subprocess.run(['ip', 'addr', 'show', interface], capture_output=True, text=True)
            ip_info = re.search(r'inet (\d+\.\d+\.\d+\.\d+)/(\d+)', result.stdout)
            ip_address = ip_info.group(1)
            netmask = ip_info.group(2)
            
            # Calculate network range
            network = ipaddress.IPv4Network(f'{ip_address}/{netmask}', strict=False)
            return str(network)
        except Exception as e:
            print(f"Error getting network range: {str(e)}")
            return None

    def update_target_details(self):
        if not self.current_target:
            QMessageBox.warning(self, "××–×”×¨×”", "×× × ×‘×—×¨ ××˜×¨×” ×œ×¢×“×›×•×Ÿ.")
            return
        
        target_file = f"targets/{self.current_target}.json"
        if os.path.exists(target_file):
            with open(target_file, 'r', encoding='utf-8') as f:
                target_data = json.load(f)
        else:
            target_data = {}
        
        new_ip, ok = QInputDialog.getText(self, "×¢×“×›×•×Ÿ ×›×ª×•×‘×ª IP", "×”×–×Ÿ ×›×ª×•×‘×ª IP ×—×“×©×”:", text=target_data.get('ip', ''))
        if ok and new_ip:
            target_data['ip'] = new_ip
            with open(target_file, 'w', encoding='utf-8') as f:
                json.dump(target_data, f, ensure_ascii=False, indent=2)
            self.current_target_ip = new_ip
            self.target_indicator.setText(f"ğŸ”’ Target: {self.current_target} ({self.current_target_ip})")
            self.output_area.append(f"×›×ª×•×‘×ª IP ×©×œ ×”××˜×¨×” '{self.current_target}' ×¢×•×“×›× ×” ×œ-{new_ip}\n")
            self.debug_window.log(f"×›×ª×•×‘×ª IP ×©×œ ×”××˜×¨×” '{self.current_target}' ×¢×•×“×›× ×” ×œ-{new_ip}")
            self.log_activity(f"×›×ª×•×‘×ª IP ×©×œ ×”××˜×¨×” '{self.current_target}' ×¢×•×“×›× ×” ×œ-{new_ip}")
            self.show_target_profile(self.targets_list.currentItem())

    def toggle_admin_mode(self):
        if not self.is_admin_mode:
            if self.request_admin_privileges():
                self.is_admin_mode = True
                self.admin_mode_button.setText("ğŸ”“ ××¦×‘ ×× ×”×œ")
                self.admin_mode_button.setStyleSheet("background-color: #FFD700;")  # ×¦×‘×¢ ×–×”×‘
                self.output_area.append("××¦×‘ ×× ×”×œ ×”×•×¤×¢×œ. ×™×© ×œ×”×©×ª××© ×‘×–×”×™×¨×•×ª!")
                self.debug_window.log("××¦×‘ ×× ×”×œ ×”×•×¤×¢×œ")
            else:
                self.output_area.append("×œ× × ×™×ª×Ÿ ×œ×”×¤×¢×™×œ ××¦×‘ ×× ×”×œ. × ×“×¨×©×•×ª ×”×¨×©××•×ª ×× ×”×œ.")
        else:
            self.is_admin_mode = False
            self.admin_mode_button.setText("ğŸ”’ ××¦×‘ ×¨×’×™×œ")
            self.admin_mode_button.setStyleSheet("")  # ×—×–×¨×” ×œ×¡×’× ×•×Ÿ ×¨×’×™×œ
            self.output_area.append("××¦×‘ ×× ×”×œ ×›×•×‘×”.")
            self.debug_window.log("××¦×‘ ×× ×”×œ ×›×•×‘×”")

    def request_admin_privileges(self):
        if sys.platform == 'win32':
            try:
                return ctypes.windll.shell32.IsUserAnAdmin() or ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, " ".join(sys.argv), None, 1) > 32
            except:
                return False
        elif sys.platform == 'linux':
            if os.geteuid() == 0:
                return True
            else:
                try:
                    subprocess.check_call(['sudo', '-v'])
                    return True
                except subprocess.CalledProcessError:
                    return False
        else:  # macOS ××• ××¢×¨×›×•×ª ××—×¨×•×ª
            return os.geteuid() == 0

    def run_with_admin(self, func, *args, **kwargs):
        if self.is_admin_mode:
            if sys.platform == 'win32':
                # ×‘Windows, ×”×¤×¢×œ ××ª ×”×¤×•× ×§×¦×™×” ×¢× ×”×¨×©××•×ª ×× ×”×œ
                return ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, f"-c \"import {func.__module__}; {func.__module__}.{func.__name__}(*{args}, **{kwargs})\"", None, 1)
            elif sys.platform in ['linux', 'darwin']:
                # ×‘Linux ×•-macOS, ×”×©×ª××© ×‘-sudo
                cmd = f"sudo python3 -c \"import {func.__module__}; {func.__module__}.{func.__name__}(*{args}, **{kwargs})\""
                return subprocess.call(cmd, shell=True)
        else:
            # ×”×¤×¢×œ ××ª ×”×¤×•× ×§×¦×™×” ×‘××•×¤×Ÿ ×¨×’×™×œ
            return func(*args, **kwargs)

    def refresh_targets(self):
        """Refresh the targets list"""
        self.load_targets()
        self.output_area.append("×¨×©×™××ª ×”××˜×¨×•×ª ×¨×•×¢× × ×”\n")
        self.debug_window.log("×¨×©×™××ª ×”××˜×¨×•×ª ×¨×•×¢× × ×”")

    def validate_target_file(self, file_path):
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
                required_fields = ['name', 'ip']
                for field in required_fields:
                    if field not in data:
                        return False
                return True
        except Exception:
            return False

class TerminalWindow(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("Terminal Output")
        self.setGeometry(100, 100, 600, 400)
        layout = QVBoxLayout(self)
        self.output = QTextEdit(self)
        self.output.setReadOnly(True)
        layout.addWidget(self.output)
        self.process = QProcess(self)
        self.process.readyReadStandardOutput.connect(self.handle_stdout)
        self.process.readyReadStandardError.connect(self.handle_stderr)

    def run_command(self, command):
        self.output.clear()
        self.process.start(command)

    def handle_stdout(self):
        data = self.process.readAllStandardOutput().data().decode()
        self.output.append(data)

    def handle_stderr(self):
        data = self.process.readAllStandardError().data().decode()
        self.output.append(data)

class OperationSettingsDialog(QDialog):
    def __init__(self, operation_name, parent=None):
        super().__init__(parent)
        self.setWindowTitle(f"×”×’×“×¨×•×ª {operation_name}")
        self.operation_name = operation_name
        self.layout = QVBoxLayout(self)
        self.settings = {}

        if operation_name == "×¡×¨×™×§×”":
            self.add_scan_settings()
        elif operation_name == "× ×™×¦×•×œ":
            self.add_exploitation_settings()
        elif operation_name == "×ª× ×•×¢×” ×¨×•×—×‘×™×ª":
            self.add_lateral_movement_settings()
        elif operation_name == "×”×ª××“×”":
            self.add_persistence_settings()
        elif operation_name == "×“×™×•×•×—":
            self.add_reporting_settings()
        # ×”×•×¡×£ ×›××Ÿ ×ª× ××™× × ×•×¡×¤×™× ×œ×¤×¢×•×œ×•×ª ××—×¨×•×ª

    def add_scan_settings(self):
        scan_types = [
            "1. ×¡×¨×™×§×” ××”×™×¨×” (×¤×•×¨×˜×™× × ×¤×•×¦×™×)",
            "2. ×¡×¨×™×§×” ××œ××” (×›×œ ×”×¤×•×¨×˜×™×)",
            "3. ×¡×¨×™×§×ª ×©×™×¨×•×ª×™× ×•×’×¨×¡××•×ª",
            "4. ×¡×¨×™×§×ª ××¢×¨×›×ª ×”×¤×¢×œ×”"
        ]
        self.scan_type_combo = QComboBox()
        self.scan_type_combo.addItems(scan_types)
        self.layout.addWidget(QLabel("×¡×•×’ ×¡×¨×™×§×”:"))
        self.layout.addWidget(self.scan_type_combo)

    def add_exploitation_settings(self):
        self.exploit_input = QLineEdit()
        self.layout.addWidget(QLabel("×©× ×”-exploit:"))
        self.layout.addWidget(self.exploit_input)

    def add_lateral_movement_settings(self):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×”×’×“×¨×•×ª ×œ×ª× ×•×¢×” ×¨×•×—×‘×™×ª
        pass

    def add_persistence_settings(self):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×”×’×“×¨×•×ª ×œ×”×ª××“×”
        pass

    def add_reporting_settings(self):
        # ×”×•×¡×£ ×›××Ÿ ××ª ×”×”×’×“×¨×•×ª ×œ×“×™×•×•×—
        pass

    def get_settings(self):
        if self.operation_name == "×¡×¨×™×§×”":
            self.settings['scan_type'] = self.scan_type_combo.currentText()[0]
        elif self.operation_name == "× ×™×¦×•×œ":
            self.settings['exploit'] = self.exploit_input.text()
        return self.settings

def main():
    app = QApplication(sys.argv)
    
    # Set the global style
    app.setStyle("Fusion")
    palette = QPalette()
    
    # Define base colors with transparency
    base_color = QColor(30, 30, 30, 200)
    text_color = QColor(255, 255, 255, 230)
    highlight_color = QColor(42, 130, 218, 200)
    
    palette.setColor(QPalette.Window, base_color)
    palette.setColor(QPalette.WindowText, text_color)
    palette.setColor(QPalette.Base, QColor(25, 25, 25, 200))
    palette.setColor(QPalette.AlternateBase, base_color)
    palette.setColor(QPalette.ToolTipBase, base_color)
    palette.setColor(QPalette.ToolTipText, text_color)
    palette.setColor(QPalette.Text, text_color)
    palette.setColor(QPalette.Button, base_color)
    palette.setColor(QPalette.ButtonText, text_color)
    palette.setColor(QPalette.BrightText, Qt.red)
    palette.setColor(QPalette.Link, highlight_color)
    palette.setColor(QPalette.Highlight, highlight_color)
    palette.setColor(QPalette.HighlightedText, Qt.black)
    
    app.setPalette(palette)
    
    # Set a semi-transparent background image (optional)
    background_image = QPixmap("background.jpg")  # Make sure you have this image
    if not background_image.isNull():
        background_label = QLabel(window)
        background_label.setPixmap(background_image)
        background_label.setGeometry(0, 0, 1200, 800)  # Adjust size as needed
        background_label.setStyleSheet("QLabel { background-color: rgba(0, 0, 0, 100); }")
        background_label.lower()
    
    window = HacKingProGUI()
    window.show()
    sys.exit(app.exec_())

if __name__ == "__main__":
    main()
